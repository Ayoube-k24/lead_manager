[1mdiff --git a/app/Services/LeadConfirmationService.php b/app/Services/LeadConfirmationService.php[m
[1mindex 97705c0..da0bdd4 100644[m
[1m--- a/app/Services/LeadConfirmationService.php[m
[1m+++ b/app/Services/LeadConfirmationService.php[m
[36m@@ -63,22 +63,55 @@[m [mpublic function sendConfirmationEmail(Lead $lead): bool[m
         $bodyHtml = $this->renderTemplate($emailTemplate->body_html, $variables);[m
         $bodyText = $this->renderTemplate($emailTemplate->body_text ?? '', $variables);[m
 [m
[32m+[m[32m        // Get decrypted password[m
[32m+[m[32m        $password = $smtpProfile->password;[m
[32m+[m
[32m+[m[32m        // Log configuration for debugging (without password)[m
[32m+[m[32m        Log::debug('Sending confirmation email', [[m
[32m+[m[32m            'lead_id' => $lead->id,[m
[32m+[m[32m            'email' => $lead->email,[m
[32m+[m[32m            'smtp_host' => $smtpProfile->host,[m
[32m+[m[32m            'smtp_port' => $smtpProfile->port,[m
[32m+[m[32m            'smtp_username' => $smtpProfile->username,[m
[32m+[m[32m            'smtp_encryption' => $smtpProfile->encryption,[m
[32m+[m[32m            'from_address' => $smtpProfile->from_address,[m
[32m+[m[32m            'from_name' => $smtpProfile->from_name,[m
[32m+[m[32m            'password_set' => ! empty($password),[m
[32m+[m[32m            'password_length' => $password ? strlen($password) : 0,[m
[32m+[m[32m        ]);[m
[32m+[m
[32m+[m[32m        // Check if password is available[m
[32m+[m[32m        if (empty($password)) {[m
[32m+[m[32m            Log::error('SMTP password is empty or could not be decrypted', [[m
[32m+[m[32m                'lead_id' => $lead->id,[m
[32m+[m[32m                'smtp_profile_id' => $smtpProfile->id,[m
[32m+[m[32m            ]);[m
[32m+[m
[32m+[m[32m            return false;[m
[32m+[m[32m        }[m
[32m+[m
         // Configure mailer with SMTP profile[m
[31m-        $mailer = $this->configureMailer($smtpProfile);[m
[32m+[m[32m        $mailer = $this->configureMailer($smtpProfile, $password);[m
 [m
         try {[m
             // Send email synchronously (directly) without timeout restrictions[m
             // If sending fails, it will be queued for retry[m
[31m-            $mailer->raw($bodyText, function ($message) use ($lead, $smtpProfile, $subject, $bodyHtml) {[m
[32m+[m[32m            // Use raw() method to send HTML email[m
[32m+[m[32m            $mailer->raw($bodyHtml, function ($message) use ($lead, $smtpProfile, $subject, $bodyText) {[m
                 $message->to($lead->email)[m
                     ->subject($subject)[m
[31m-                    ->from($smtpProfile->from_address, $smtpProfile->from_name)[m
[31m-                    ->html($bodyHtml);[m
[32m+[m[32m                    ->from($smtpProfile->from_address, $smtpProfile->from_name);[m
[32m+[m
[32m+[m[32m                // Add text version if available[m
[32m+[m[32m                if (! empty($bodyText)) {[m
[32m+[m[32m                    $message->text($bodyText);[m
[32m+[m[32m                }[m
             });[m
 [m
             Log::info('Confirmation email sent successfully', [[m
                 'lead_id' => $lead->id,[m
                 'email' => $lead->email,[m
[32m+[m[32m                'smtp_host' => $smtpProfile->host,[m
             ]);[m
 [m
             return true;[m
[36m@@ -87,7 +120,10 @@[m [mpublic function sendConfirmationEmail(Lead $lead): bool[m
                 'lead_id' => $lead->id,[m
                 'email' => $lead->email,[m
                 'error' => $e->getMessage(),[m
[32m+[m[32m                'error_trace' => $e->getTraceAsString(),[m
                 'smtp_host' => $smtpProfile->host,[m
[32m+[m[32m                'smtp_port' => $smtpProfile->port,[m
[32m+[m[32m                'smtp_username' => $smtpProfile->username,[m
             ]);[m
 [m
             return false;[m
[36m@@ -133,15 +169,18 @@[m [mprotected function renderTemplate(string $template, array $variables): string[m
      *[m
      * @return \Illuminate\Mail\Mailer|\Illuminate\Support\Testing\Fakes\MailFake[m
      */[m
[31m-    protected function configureMailer(SmtpProfile $smtpProfile)[m
[32m+[m[32m    protected function configureMailer(SmtpProfile $smtpProfile, ?string $password = null)[m
     {[m
[32m+[m[32m        // Use provided password or get from model (which will decrypt it)[m
[32m+[m[32m        $decryptedPassword = $password ?? $smtpProfile->password;[m
[32m+[m
         $config = [[m
             'transport' => 'smtp',[m
             'host' => $smtpProfile->host,[m
             'port' => $smtpProfile->port,[m
             'encryption' => $smtpProfile->encryption === 'none' ? null : $smtpProfile->encryption,[m
             'username' => $smtpProfile->username,[m
[31m-            'password' => $smtpProfile->password,[m
[32m+[m[32m            'password' => $decryptedPassword,[m
             'timeout' => null,[m
         ];[m
 [m
